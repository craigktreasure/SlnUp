<?xml version="1.0" encoding="utf-8"?>
<Project InitialTargets="_ValidatePathProperties">
  <PropertyGroup Condition=" '$(EnableCentralBuildOutput)' != 'false' ">
    <RelativeProjectPath>$([MSBuild]::MakeRelative($(CentralBuildOutputPath), $(MSBuildProjectDirectory)))/</RelativeProjectPath>

    <!-- Set output root folders. -->
    <BasePackagesDir>$(CentralBuildOutputPath)__packages/</BasePackagesDir>
    <BaseNuGetDir>$(BasePackagesDir)NuGet/</BaseNuGetDir>
    <BaseOutDir>$(CentralBuildOutputPath)__output/</BaseOutDir>
    <BaseIntDir>$(CentralBuildOutputPath)__intermediate/</BaseIntDir>
    <BasePublishDir>$(CentralBuildOutputPath)__publish/</BasePublishDir>
    <BaseTestResultsDir>$(CentralBuildOutputPath)__test-results/</BaseTestResultsDir>

    <!-- Configure NuGet output folder. -->
    <PackageOutputPath>$(BaseNuGetDir)$(Configuration)/</PackageOutputPath>

    <!-- Configure project specific intermeidate and output folders. -->
    <ProjectOutputPath>$(BaseOutDir)$(Configuration)/$(Platform)/$(RelativeProjectPath)</ProjectOutputPath>

    <!-- Configure Appx output path. -->
    <AppxPackageDir>$(ProjectOutputPath)AppPackages</AppxPackageDir>

    <BaseProjectIntermediateOutputPath>$(BaseIntDir)/$(RelativeProjectPath)</BaseProjectIntermediateOutputPath>
    <BaseProjectPublishOutputPath>$(BasePublishDir)/$(Configuration)/$(Platform)/$(RelativeProjectPath)</BaseProjectPublishOutputPath>
    <BaseProjectTestResultsOutputPath>$(BaseTestResultsDir)/$(RelativeProjectPath)</BaseProjectTestResultsOutputPath>
  </PropertyGroup>

  <PropertyGroup Condition=" $(MSBuildProjectFile.EndsWith('.csproj')) ">
    <ProjectIntermediateOutputPath>$(BaseProjectIntermediateOutputPath)</ProjectIntermediateOutputPath>

    <BaseIntermediateOutputPath>$(ProjectIntermediateOutputPath)</BaseIntermediateOutputPath>
    <MSBuildProjectExtensionPath>$(BaseIntermediateOutputPath)</MSBuildProjectExtensionPath>
    <BaseOutputPath>$(ProjectOutputPath)</BaseOutputPath>
    <OutputPath>$(ProjectOutputPath)</OutputPath>
    <PublishDir>$(BaseProjectPublishOutputPath)</PublishDir>
    <VSTestResultsDirectory>$(BaseProjectTestResultsOutputPath)</VSTestResultsDirectory>
    <CoverletOutput>$(BaseProjectTestResultsOutputPath)</CoverletOutput>
  </PropertyGroup>

  <Target Name="_ValidatePathProperties" Condition=" '$(EnableCentralBuildOutput)' != 'false' ">
    <Error Text="CentralBuildOutputPath must be set before importing $(MSBuildThisFile)" Condition=" '$(CentralBuildOutputPath)' == '' " />
  </Target>
</Project>
