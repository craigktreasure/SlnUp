# Visual Studio solution updater research

The goal of this research is to determine what's required to build a tool that
allows you to easily update the Visual Studio version information in a solution
file using a Visual Studio version number.

## Why?

The Visual Studio selector tool, which determines which version of Visual Studio
to open when you double-click a .sln file, uses the solution
[file header](https://docs.microsoft.com/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2022#file-header)
to determine which version of Visual Studio to open.

Updating a solution file with correct version information requires you to
understand the solution file header and the Visual Studio version information.

## What to learn

This research details the shape of solution files generated by various tools in
order to understand what's required to handle updating the various versions of
solution files.

We'll also seek to understand the attributes of the Visual Studio version so
that we can update solution files with them appropriately.

## The Visual Studio solution file header

According to the [documentation](https://docs.microsoft.com/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2022#file-header),
the file header usually looks like this:

```
Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.28701.123
MinimumVisualStudioVersion = 10.0.40219.1
```

Standard header that defines the file format version.
> `Microsoft Visual Studio Solution File, Format Version 12.00`

The major version of Visual Studio that (most recently) saved this solution file.
This information controls the version number in the solution icon.
> `# Visual Studio Version 16`

The full version of Visual Studio that (most recently) saved the solution file.
If the solution file is saved by a newer version of Visual Studio that has the
same major version, this value is not updated so as to lessen churn in the file.
> `VisualStudioVersion = 16.0.28701.123`

The minimum (oldest) version of Visual Studio that can open this solution file.
> `MinimumVisualStudioVersion = 10.0.40219.1`

This is accurate for Visual Studio 2019 and 2022.

### Visual Studio 2017

Visual Studio 2017 has a slight variation of the file header, which is documented
[here](https://docs.microsoft.com/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2017#file-header).

```
Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio 15
VisualStudioVersion = 15.0.26730.15
MinimumVisualStudioVersion = 10.0.40219.1
```

Note the difference in the major version most recently saved: `# Visual Studio 15`
vs `# Visual Studio Version 16` for Visual Studio 2019 and above.

## Common solution sources

* Visual Studio templates
* .NET CLI
* [Visual Studio solution generator](https://microsoft.github.io/slngen/)
  (a.k.a. slngen)

### Generated by Visual Studio 2019

This was generated by Visual Studio 2019 16.11.6 for a new C# .NET 5 console
application:

```

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.31829.152
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "Generated", "Generated\Generated.csproj", "{0416C64E-01C4-4541-8305-A55FBFA0388C}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{0416C64E-01C4-4541-8305-A55FBFA0388C}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{0416C64E-01C4-4541-8305-A55FBFA0388C}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{0416C64E-01C4-4541-8305-A55FBFA0388C}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{0416C64E-01C4-4541-8305-A55FBFA0388C}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {554E3E08-EE1C-47D0-B207-103EBACAB529}
	EndGlobalSection
EndGlobal

```

The solution file contains all the expected header information.

### Generated by Visual Studio 2022

This was generated by Visual Studio 2022 17.0 for a new C# .NET 6 console
application.

```

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.0.31903.59
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "Generated", "Generated\Generated.csproj", "{391BD0B8-2B52-46AA-98D1-9D9EDCA9FA19}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{391BD0B8-2B52-46AA-98D1-9D9EDCA9FA19}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{391BD0B8-2B52-46AA-98D1-9D9EDCA9FA19}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{391BD0B8-2B52-46AA-98D1-9D9EDCA9FA19}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{391BD0B8-2B52-46AA-98D1-9D9EDCA9FA19}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {A2D44F49-9EB7-436B-8C84-67A937526801}
	EndGlobalSection
EndGlobal

```

The solution file contains all the expected header information.

### Generated by .NET CLI

This was generated by the .NET 6 SDK 6.0.100.

```

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 16
VisualStudioVersion = 16.0.30114.105
MinimumVisualStudioVersion = 10.0.40219.1
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
EndGlobal

```

The solution file contains all the expected header information.

### Generated by Visual Studio solution generator

This was generated by the Visual Studio solution generator (slngen) 7.2.0.

```
Microsoft Visual Studio Solution File, Format Version 12.00
Project("{9A19103F-16F7-4668-BE54-9A1E7A4F7556}") = "Cli", "Cli\Cli.csproj", "{7BB74C71-F9D6-416F-97CB-DB2C5C904FD0}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{7BB74C71-F9D6-416F-97CB-DB2C5C904FD0}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{7BB74C71-F9D6-416F-97CB-DB2C5C904FD0}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{7BB74C71-F9D6-416F-97CB-DB2C5C904FD0}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{7BB74C71-F9D6-416F-97CB-DB2C5C904FD0}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {1BB30EB4-5307-4751-A493-3746A4F75FCE}
	EndGlobalSection
EndGlobal

```

The solution file only contains the file format version and is missing:

* The major version comment that most recently saved the file.
* The `VisualStudioVersion`.
* The `MinimumVisualStudioVersion`.

## Visual Studio version information

The components of a Visual Studio version appear to be a simple 3 part version
and a 4-part build version. There's also a channel which defines the release
channel a version belongs to: Release or Preview.

For example, [Visual Studio 2022 version information](https://docs.microsoft.com/visualstudio/install/visual-studio-build-numbers-and-release-dates?view=vs-2022)
looks like this:

| Version | Build Version  | Channel    |
| ---     | ---            | ---        |
| 17.0.1  | 17.1.31903.286 | Preview 1  |
| 17.0.0  | 17.0.31903.59  | Release    |
| 17.0.0  | 17.0.31825.309 | Preview 7  |

## Requirements

* Support solution files with file format version `12.00`.
* Support solution files with all header information.
* Support solution files without all header information by adding the missing
  information for the version specified.

## Out of scope

* Generating new solution files.
* Support for anything pre-Visual Studio 2017.

## Resources

* [Visual Studio solution files](https://docs.microsoft.com/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2022)

### Visual Studio version numbers

* [Visual Studio 2017 build numbers and release dates](https://docs.microsoft.com/visualstudio/install/visual-studio-build-numbers-and-release-dates?view=vs-2017)
* [Visual Studio 2019 build numbers and release dates](https://docs.microsoft.com/visualstudio/install/visual-studio-build-numbers-and-release-dates?view=vs-2019)
* [Visual Studio 2022 build numbers and release dates](https://docs.microsoft.com/visualstudio/install/visual-studio-build-numbers-and-release-dates?view=vs-2022)
